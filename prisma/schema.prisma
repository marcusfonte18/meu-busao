// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Bus {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  ordem            String
  linha            String
  latitude         String
  longitude        String
  datahora         DateTime @default(now())
  velocidade       String
  datahoraenvio    DateTime @default(now())
  datahoraservidor DateTime @default(now())
  timestamp        DateTime @default(now())

  @@map("onibuses")
}

model Line {
  id           String @id @default(auto()) @map("_id") @db.ObjectId
  numero       String @unique
  nome         String
  tipo         String // "onibus" | "brt" — do GTFS (route_type, agency, nome)
  numeroSearch String // lowercase, sem acentos — para busca
  nomeSearch   String // lowercase, sem acentos — para busca

  @@map("linhas")
}

model Brt {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  codigo     String   @unique
  placa      String?
  linha      String
  latitude   Float
  longitude  Float
  dataHora   DateTime
  velocidade Float
  direcao    Float?

  @@map("brt")
}

/// Traçados das linhas (GTFS shapes) para desenhar no mapa. Populado por: pnpm run seed:route-shapes
model RouteShape {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  linha     String @unique
  polylines Json   // [ [ [lat,lng], ... ], ... ] — array de polylines por linha
  @@map("route_shapes")
}
